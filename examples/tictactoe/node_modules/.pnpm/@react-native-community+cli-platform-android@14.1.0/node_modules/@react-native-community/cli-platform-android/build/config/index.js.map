{"version":3,"names":["projectConfig","root","userConfig","src","sourceDir","findAndroidDir","path","join","appName","getAppName","manifestPath","findManifest","buildGradlePath","findBuildGradle","packageName","getPackageName","CLIError","applicationId","getApplicationId","mainActivity","getMainActivity","unstable_reactLegacyComponentNames","logger","warn","dependencyConfiguration","watchModeCommandParams","undefined","assets","appId","parseApplicationIdFromBuildGradleFile","userConfigAppName","fs","existsSync","dependencyConfig","isPureCxxDependency","cxxModuleCMakeListsModuleName","cxxModuleCMakeListsPath","cxxModuleHeaderName","packageImportPath","packageInstance","packageClassName","findPackageClassName","buildTypes","libraryName","findLibraryName","componentDescriptors","findComponentDescriptors","cmakeListsPath","process","platform","replace"],"sources":["../../src/config/index.ts"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport findAndroidDir from './findAndroidDir';\nimport findManifest from './findManifest';\nimport findPackageClassName from './findPackageClassName';\nimport {\n  AndroidProjectParams,\n  AndroidProjectConfig,\n  AndroidDependencyParams,\n  AndroidDependencyConfig,\n} from '@react-native-community/cli-types';\nimport {\n  getPackageName,\n  parseApplicationIdFromBuildGradleFile,\n} from './getAndroidProject';\nimport {findLibraryName} from './findLibraryName';\nimport {findComponentDescriptors} from './findComponentDescriptors';\nimport {findBuildGradle} from './findBuildGradle';\nimport {CLIError, logger} from '@react-native-community/cli-tools';\nimport getMainActivity from './getMainActivity';\n\n/**\n * Gets android project config by analyzing given folder and taking some\n * defaults specified by user into consideration\n */\nexport function projectConfig(\n  root: string,\n  userConfig: AndroidProjectParams = {},\n): AndroidProjectConfig | null {\n  const src = userConfig.sourceDir || findAndroidDir(root);\n\n  if (!src) {\n    return null;\n  }\n\n  const sourceDir = path.join(root, src);\n\n  const appName = getAppName(sourceDir, userConfig.appName);\n\n  const manifestPath = userConfig.manifestPath\n    ? path.join(sourceDir, userConfig.manifestPath)\n    : findManifest(path.join(sourceDir, appName));\n  const buildGradlePath = findBuildGradle(sourceDir, false);\n\n  if (!manifestPath && !buildGradlePath) {\n    return null;\n  }\n\n  const packageName =\n    userConfig.packageName || getPackageName(manifestPath, buildGradlePath);\n\n  if (!packageName) {\n    throw new CLIError(\n      `Package name not found in neither ${manifestPath} nor ${buildGradlePath}`,\n    );\n  }\n\n  const applicationId = buildGradlePath\n    ? getApplicationId(buildGradlePath, packageName)\n    : packageName;\n  const mainActivity = getMainActivity(manifestPath || '') ?? '';\n\n  // @todo remove for RN 0.75\n  if (userConfig.unstable_reactLegacyComponentNames) {\n    logger.warn(\n      'The \"project.android.unstable_reactLegacyComponentNames\" config option is not necessary anymore for React Native 0.74 and does nothing. Please remove it from the \"react-native.config.js\" file.',\n    );\n  }\n\n  return {\n    sourceDir,\n    appName,\n    packageName,\n    applicationId,\n    mainActivity,\n    dependencyConfiguration: userConfig.dependencyConfiguration,\n    watchModeCommandParams: userConfig.watchModeCommandParams,\n    // @todo remove for RN 0.75\n    unstable_reactLegacyComponentNames: undefined,\n    assets: userConfig.assets ?? [],\n  };\n}\n\nfunction getApplicationId(buildGradlePath: string, packageName: string) {\n  let appId = packageName;\n\n  const applicationId = parseApplicationIdFromBuildGradleFile(buildGradlePath);\n  if (applicationId) {\n    appId = applicationId;\n  }\n  return appId;\n}\n\nfunction getAppName(sourceDir: string, userConfigAppName: string | undefined) {\n  let appName = '';\n  if (\n    typeof userConfigAppName === 'string' &&\n    fs.existsSync(path.join(sourceDir, userConfigAppName))\n  ) {\n    appName = userConfigAppName;\n  } else if (fs.existsSync(path.join(sourceDir, 'app'))) {\n    appName = 'app';\n  }\n  return appName;\n}\n\n/**\n * Same as projectConfigAndroid except it returns\n * different config that applies to packages only\n */\nexport function dependencyConfig(\n  root: string,\n  userConfig: AndroidDependencyParams | null = {},\n): AndroidDependencyConfig | null {\n  if (userConfig === null) {\n    return null;\n  }\n\n  const src = userConfig.sourceDir || findAndroidDir(root);\n\n  if (!src) {\n    return null;\n  }\n\n  const sourceDir = path.join(root, src);\n  const manifestPath = userConfig.manifestPath\n    ? path.join(sourceDir, userConfig.manifestPath)\n    : findManifest(sourceDir);\n  const buildGradlePath = findBuildGradle(sourceDir, true);\n  const isPureCxxDependency =\n    userConfig.cxxModuleCMakeListsModuleName != null &&\n    userConfig.cxxModuleCMakeListsPath != null &&\n    userConfig.cxxModuleHeaderName != null &&\n    !manifestPath &&\n    !buildGradlePath;\n\n  if (!manifestPath && !buildGradlePath && !isPureCxxDependency) {\n    return null;\n  }\n\n  let packageImportPath = null,\n    packageInstance = null;\n\n  if (!isPureCxxDependency) {\n    const packageName =\n      userConfig.packageName || getPackageName(manifestPath, buildGradlePath);\n    const packageClassName = findPackageClassName(sourceDir);\n\n    /**\n     * This module has no package to export\n     */\n    if (!packageClassName) {\n      return null;\n    }\n\n    packageImportPath =\n      userConfig.packageImportPath ||\n      `import ${packageName}.${packageClassName};`;\n\n    packageInstance = userConfig.packageInstance || `new ${packageClassName}()`;\n  }\n\n  const buildTypes = userConfig.buildTypes || [];\n  const dependencyConfiguration = userConfig.dependencyConfiguration;\n  const libraryName =\n    userConfig.libraryName || findLibraryName(root, sourceDir);\n  const componentDescriptors =\n    userConfig.componentDescriptors || findComponentDescriptors(root);\n  let cmakeListsPath = userConfig.cmakeListsPath\n    ? path.join(sourceDir, userConfig.cmakeListsPath)\n    : path.join(sourceDir, 'build/generated/source/codegen/jni/CMakeLists.txt');\n  const cxxModuleCMakeListsModuleName =\n    userConfig.cxxModuleCMakeListsModuleName || null;\n  const cxxModuleHeaderName = userConfig.cxxModuleHeaderName || null;\n  let cxxModuleCMakeListsPath = userConfig.cxxModuleCMakeListsPath\n    ? path.join(sourceDir, userConfig.cxxModuleCMakeListsPath)\n    : null;\n\n  if (process.platform === 'win32') {\n    cmakeListsPath = cmakeListsPath.replace(/\\\\/g, '/');\n    if (cxxModuleCMakeListsPath) {\n      cxxModuleCMakeListsPath = cxxModuleCMakeListsPath.replace(/\\\\/g, '/');\n    }\n  }\n\n  return {\n    sourceDir,\n    packageImportPath,\n    packageInstance,\n    buildTypes,\n    dependencyConfiguration,\n    libraryName,\n    componentDescriptors,\n    cmakeListsPath,\n    cxxModuleCMakeListsModuleName,\n    cxxModuleCMakeListsPath,\n    cxxModuleHeaderName,\n    isPureCxxDependency,\n  };\n}\n"],"mappings":"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"}