{"version":3,"names":["DEFAULT_VERSION","YARN_VERSION","bumpYarnVersion","root","yarnVersion","semver","parse","getYarnVersionIfAvailable","setVersionArgs","major","minor","executeCommand","silent","logger","isVerbose","e","debug","doesDirectoryExist","dir","fs","existsSync","getConflictsForDirectory","directory","readdirSync","setProjectDirectory","replaceDirectory","directoryExists","DirectoryAlreadyExistsError","deleteDirectory","conflicts","length","warnMessage","chalk","bold","conflict","warn","replace","prompt","type","name","message","removeSync","mkdirSync","recursive","process","chdir","error","CLIError","cwd","getTemplateName","Object","keys","JSON","readFileSync","path","join","dependencies","setEmptyHashForCachedDependencies","projectName","cacheManager","set","createHash","update","digest","createFromTemplate","shouldBumpYarnVersion","templateUri","npm","pm","projectTitle","skipInstall","packageName","installCocoaPods","yarnConfigOptions","version","env","CI","log","banner","undefined","didInstallPods","String","packageManager","userAgentPM","userAgentPackageManager","removeProjectCache","projectDirectory","loader","getLoader","text","templateSourceDir","mkdtempSync","os","tmpdir","start","installTemplatePackage","succeed","templateName","templateConfig","getTemplateConfig","copyTemplate","templateDir","changePlaceholderInTemplate","placeholderName","placeholderTitle","titlePlaceholder","postInitScript","info","executePostInitScript","installDependencies","platform","installPodsValue","installPods","installCocoapods","reset","dim","fail","Error","underline","PackageManager","installAll","checkPackageManagerAvailability","getBunVersionIfAvailable","getNpmVersionIfAvailable","createProject","options","createTemplateUri","title","userAgent","npm_config_user_agent","startsWith","initialize","projName","validateProjectName","updatedVersion","npmResolveConcreteVersion","platformName","template","semverVersion","coerce","gte","TEMPLATE_COMMUNITY_REACT_NATIVE_VERSION","TemplateAndVersionError","directoryName","relative","projectFolder","shouldCreateGitRepository","isGitAvailable","checkGitInstallation","isFolderGitRepo","checkIfFolderIsGitRepo","skipGitInit","createGitRepository","printRunInstructions","showPodsInstructions"],"sources":["../../../src/commands/init/init.ts"],"sourcesContent":["import os from 'os';\nimport path from 'path';\nimport fs, {readdirSync} from 'fs-extra';\nimport {validateProjectName} from './validate';\nimport chalk from 'chalk';\nimport printRunInstructions from './printRunInstructions';\nimport {\n  CLIError,\n  logger,\n  getLoader,\n  Loader,\n  cacheManager,\n  prompt,\n} from '@react-native-community/cli-tools';\nimport {installPods} from '@react-native-community/cli-platform-apple';\nimport {\n  installTemplatePackage,\n  getTemplateConfig,\n  copyTemplate,\n  executePostInitScript,\n} from './template';\nimport {changePlaceholderInTemplate} from './editTemplate';\nimport * as PackageManager from '../../tools/packageManager';\nimport banner from './banner';\nimport TemplateAndVersionError from './errors/TemplateAndVersionError';\nimport {getBunVersionIfAvailable} from '../../tools/bun';\nimport {\n  getNpmVersionIfAvailable,\n  npmResolveConcreteVersion,\n} from '../../tools/npm';\nimport {getYarnVersionIfAvailable} from '../../tools/yarn';\nimport {createHash} from 'crypto';\nimport {\n  createGitRepository,\n  checkGitInstallation,\n  checkIfFolderIsGitRepo,\n} from './git';\nimport semver from 'semver';\nimport {executeCommand} from '../../tools/executeCommand';\nimport DirectoryAlreadyExistsError from './errors/DirectoryAlreadyExistsError';\nimport {createTemplateUri} from './version';\nimport {TEMPLATE_COMMUNITY_REACT_NATIVE_VERSION} from './constants';\nimport type {Options} from './types';\n\nconst DEFAULT_VERSION = 'latest';\n\ninterface TemplateOptions {\n  projectName: string;\n  shouldBumpYarnVersion: boolean;\n  templateUri: string;\n  npm?: boolean;\n  pm?: PackageManager.PackageManager;\n  directory: string;\n  projectTitle?: string;\n  skipInstall?: boolean;\n  packageName?: string;\n  installCocoaPods?: string | boolean;\n  version: string;\n  replaceDirectory?: string | boolean;\n  yarnConfigOptions?: Record<string, string>;\n}\n\ninterface TemplateReturnType {\n  didInstallPods?: boolean;\n  replaceDirectory?: string | boolean;\n}\n\n// Here we are defining explicit version of Yarn to be used in the new project because in some cases providing `3.x` don't work.\nconst YARN_VERSION = '3.6.4';\n\nconst bumpYarnVersion = async (root: string) => {\n  try {\n    let yarnVersion = semver.parse(getYarnVersionIfAvailable());\n\n    if (yarnVersion) {\n      // `yarn set` is unsupported until 1.22, however it's a alias (yarnpkg/yarn/pull/7862) calling `policies set-version`.\n      let setVersionArgs = ['set', 'version', YARN_VERSION];\n      if (yarnVersion.major === 1 && yarnVersion.minor < 22) {\n        setVersionArgs = ['policies', 'set-version', YARN_VERSION];\n      }\n      await executeCommand('yarn', setVersionArgs, {\n        root,\n        silent: !logger.isVerbose(),\n      });\n\n      // React Native doesn't support PnP, so we need to set nodeLinker to node-modules. Read more here: https://github.com/react-native-community/cli/issues/27#issuecomment-1772626767\n      await executeCommand(\n        'yarn',\n        ['config', 'set', 'nodeLinker', 'node-modules'],\n        {root, silent: !logger.isVerbose()},\n      );\n    }\n  } catch (e) {\n    logger.debug(e as string);\n  }\n};\n\nfunction doesDirectoryExist(dir: string) {\n  return fs.existsSync(dir);\n}\n\nfunction getConflictsForDirectory(directory: string) {\n  return readdirSync(directory);\n}\n\nasync function setProjectDirectory(\n  directory: string,\n  replaceDirectory: string,\n) {\n  const directoryExists = doesDirectoryExist(directory);\n\n  if (replaceDirectory === 'false' && directoryExists) {\n    throw new DirectoryAlreadyExistsError(directory);\n  }\n\n  let deleteDirectory = false;\n\n  if (replaceDirectory === 'true' && directoryExists) {\n    deleteDirectory = true;\n  } else if (directoryExists) {\n    const conflicts = getConflictsForDirectory(directory);\n\n    if (conflicts.length > 0) {\n      let warnMessage = `The directory ${chalk.bold(\n        directory,\n      )} contains files that will be overwritten:\\n`;\n\n      for (const conflict of conflicts) {\n        warnMessage += `   ${conflict}\\n`;\n      }\n\n      logger.warn(warnMessage);\n\n      const {replace} = await prompt({\n        type: 'confirm',\n        name: 'replace',\n        message: 'Do you want to replace existing files?',\n      });\n\n      deleteDirectory = replace;\n\n      if (!replace) {\n        throw new DirectoryAlreadyExistsError(directory);\n      }\n    }\n  }\n\n  try {\n    if (deleteDirectory) {\n      fs.removeSync(directory);\n    }\n\n    fs.mkdirSync(directory, {recursive: true});\n    process.chdir(directory);\n  } catch (error) {\n    throw new CLIError(\n      'Error occurred while trying to create project directory.',\n      error as Error,\n    );\n  }\n\n  return process.cwd();\n}\n\nfunction getTemplateName(cwd: string) {\n  // We use package manager to infer the name of the template module for us.\n  // That's why we get it from temporary package.json, where the name is the\n  // first and only dependency (hence 0).\n  const name = Object.keys(\n    JSON.parse(fs.readFileSync(path.join(cwd, './package.json'), 'utf8'))\n      .dependencies,\n  )[0];\n  return name;\n}\n\n//set cache to empty string to prevent installing cocoapods on freshly created project\nfunction setEmptyHashForCachedDependencies(projectName: string) {\n  cacheManager.set(\n    projectName,\n    'dependencies',\n    createHash('md5').update('').digest('hex'),\n  );\n}\n\nasync function createFromTemplate({\n  projectName,\n  shouldBumpYarnVersion,\n  templateUri,\n  npm,\n  pm,\n  directory,\n  projectTitle,\n  skipInstall,\n  packageName,\n  installCocoaPods,\n  replaceDirectory,\n  yarnConfigOptions,\n  version,\n}: TemplateOptions): Promise<TemplateReturnType> {\n  logger.debug('Initializing new project');\n  // Only print out the banner if we're not in a CI\n  if (!process.env.CI) {\n    logger.log(banner(version !== DEFAULT_VERSION ? version : undefined));\n  }\n  let didInstallPods = String(installCocoaPods) === 'true';\n  let packageManager = pm;\n\n  if (pm) {\n    packageManager = pm;\n  } else {\n    const userAgentPM = userAgentPackageManager();\n    // if possible, use the package manager from the user agent. Otherwise fallback to default (yarn)\n    packageManager = userAgentPM || 'yarn';\n  }\n\n  if (npm) {\n    logger.warn(\n      'Flag --npm is deprecated and will be removed soon. In the future, please use --pm npm instead.',\n    );\n\n    packageManager = 'npm';\n  }\n\n  // if the project with the name already has cache, remove the cache to avoid problems with pods installation\n  cacheManager.removeProjectCache(projectName);\n\n  const projectDirectory = await setProjectDirectory(\n    directory,\n    String(replaceDirectory),\n  );\n\n  const loader = getLoader({text: 'Downloading template'});\n  const templateSourceDir = fs.mkdtempSync(\n    path.join(os.tmpdir(), 'rncli-init-template-'),\n  );\n\n  try {\n    loader.start();\n\n    await installTemplatePackage(\n      templateUri,\n      templateSourceDir,\n      packageManager,\n      yarnConfigOptions,\n    );\n\n    loader.succeed();\n    loader.start('Copying template');\n\n    const templateName = getTemplateName(templateSourceDir);\n    const templateConfig = getTemplateConfig(templateName, templateSourceDir);\n    await copyTemplate(\n      templateName,\n      templateConfig.templateDir,\n      templateSourceDir,\n    );\n\n    loader.succeed();\n    loader.start('Processing template');\n\n    await changePlaceholderInTemplate({\n      projectName,\n      projectTitle,\n      placeholderName: templateConfig.placeholderName,\n      placeholderTitle: templateConfig.titlePlaceholder,\n      packageName,\n    });\n\n    if (packageManager === 'yarn' && shouldBumpYarnVersion) {\n      await bumpYarnVersion(projectDirectory);\n    }\n\n    loader.succeed();\n    const {postInitScript} = templateConfig;\n    if (postInitScript) {\n      loader.info('Executing post init script ');\n      await executePostInitScript(\n        templateName,\n        postInitScript,\n        templateSourceDir,\n      );\n    }\n\n    if (!skipInstall) {\n      await installDependencies({\n        packageManager,\n        loader,\n        root: projectDirectory,\n      });\n\n      if (process.platform === 'darwin') {\n        const installPodsValue = String(installCocoaPods);\n\n        if (installPodsValue === 'true') {\n          didInstallPods = true;\n          await installPods(loader);\n          loader.succeed();\n          setEmptyHashForCachedDependencies(projectName);\n        } else if (installPodsValue === 'undefined') {\n          const {installCocoapods} = await prompt({\n            type: 'confirm',\n            name: 'installCocoapods',\n            message: `Do you want to install CocoaPods now? ${chalk.reset.dim(\n              'Only needed if you run your project in Xcode directly',\n            )}`,\n          });\n          didInstallPods = installCocoapods;\n\n          if (installCocoapods) {\n            await installPods(loader);\n            loader.succeed();\n            setEmptyHashForCachedDependencies(projectName);\n          }\n        }\n      }\n    } else {\n      didInstallPods = false;\n      loader.succeed('Dependencies installation skipped');\n    }\n  } catch (e) {\n    loader.fail();\n    if (e instanceof Error) {\n      logger.error(\n        'Installing pods failed. This doesn\\'t affect project initialization and you can safely proceed. \\nHowever, you will need to install pods manually when running iOS, follow additional steps in \"Run instructions for iOS\" section.\\n',\n      );\n      logger.debug(e as any);\n    }\n    didInstallPods = false;\n  } finally {\n    fs.removeSync(templateSourceDir);\n  }\n\n  if (process.platform === 'darwin') {\n    logger.info(\n      `üí° To enable automatic CocoaPods installation when building for iOS you can create react-native.config.js with automaticPodsInstallation field. \\n${chalk.reset.dim(\n        `For more details, see ${chalk.underline(\n          'https://github.com/react-native-community/cli/blob/main/docs/projects.md#projectiosautomaticpodsinstallation',\n        )}`,\n      )}\n            `,\n    );\n  }\n\n  return {didInstallPods};\n}\n\nasync function installDependencies({\n  packageManager,\n  loader,\n  root,\n}: {\n  packageManager: PackageManager.PackageManager;\n  loader: Loader;\n  root: string;\n}) {\n  loader.start('Installing dependencies');\n\n  await PackageManager.installAll({\n    packageManager,\n    silent: true,\n    root,\n  });\n\n  loader.succeed();\n}\n\nfunction checkPackageManagerAvailability(\n  packageManager: PackageManager.PackageManager,\n) {\n  if (packageManager === 'bun') {\n    return getBunVersionIfAvailable();\n  } else if (packageManager === 'npm') {\n    return getNpmVersionIfAvailable();\n  } else if (packageManager === 'yarn') {\n    return getYarnVersionIfAvailable();\n  }\n\n  return false;\n}\n\nasync function createProject(\n  projectName: string,\n  directory: string,\n  version: string,\n  shouldBumpYarnVersion: boolean,\n  options: Options,\n): Promise<TemplateReturnType> {\n  // Handle these cases (when community template is published and react-native >= 0.75\n  //\n  // +==================================================================+==========+===================+\n  // | Arguments                                                        | Template |   React Native    |\n  // +==================================================================+==========+===================+\n  // | <None>                                                           | 0.74.x   | 0.74.5 (latest)   |\n  // +------------------------------------------------------------------+----------+-------------------+\n  // | --version next                                                   | 0.75.x   | 0.75.0-rc.1 (next)|\n  // +------------------------------------------------------------------+----------+-------------------+\n  // | --version 0.75.0                                                 | 0.75.x   | 0.75.0            |\n  // +------------------------------------------------------------------+----------+-------------------+\n  // | --template @react-native-community/template@0.75.1               | 0.75.1   | latest            |\n  // +------------------------------------------------------------------+----------+-------------------+\n  // | --template @react-native-community/template@0.75.1 --version 0.75| 0.75.1   | 0.75.x            |\n  // +------------------------------------------------------------------+----------+-------------------+\n  //\n  // 1. If you specify `--version 0.75.0` and `@react-native-community/template@0.75.0` is *NOT*\n  // published, then `init` will exit and suggest explicitly using the `--template` argument.\n  //\n  // 2. `--template` will always win over `--version` for the template.\n  //\n  // 3. For version < 0.75, the template ships with react-native.\n  const templateUri = await createTemplateUri(options, version);\n\n  logger.debug(`Template: '${templateUri}'`);\n\n  return createFromTemplate({\n    projectName,\n    shouldBumpYarnVersion,\n    templateUri,\n    npm: options.npm,\n    pm: options.pm,\n    directory,\n    projectTitle: options.title,\n    skipInstall: options.skipInstall,\n    packageName: options.packageName,\n    installCocoaPods: options.installPods,\n    version,\n    replaceDirectory: options.replaceDirectory,\n    yarnConfigOptions: options.yarnConfigOptions,\n  });\n}\n\nfunction userAgentPackageManager() {\n  const userAgent = process.env.npm_config_user_agent;\n\n  if (userAgent && userAgent.startsWith('bun')) {\n    return 'bun';\n  }\n\n  return null;\n}\n\nexport default (async function initialize(\n  [projectName]: Array<string>,\n  options: Options,\n) {\n  if (!projectName) {\n    const {projName} = await prompt({\n      type: 'text',\n      name: 'projName',\n      message: 'How would you like to name the app?',\n    });\n    projectName = projName;\n  }\n\n  validateProjectName(projectName);\n\n  let version = options.version ?? DEFAULT_VERSION;\n\n  try {\n    const updatedVersion = await npmResolveConcreteVersion(\n      options.platformName ?? 'react-native',\n      version,\n    );\n    logger.debug(`Mapped: ${version} -> ${updatedVersion}`);\n    version = updatedVersion;\n  } catch (e) {\n    logger.debug(\n      `Failed to get concrete version from '${version}': `,\n      e as any,\n    );\n  }\n\n  // From 0.75 it actually is useful to be able to specify both the template and react-native version.\n  // This should only be used by people who know what they're doing.\n  if (!!options.template && !!options.version) {\n    // 0.75.0-nightly-20240618-5df5ed1a8' -> 0.75.0\n    // 0.75.0-rc.1 -> 0.75.0\n    const semverVersion = semver.coerce(version)?.version ?? version;\n    if (semver.gte(semverVersion, TEMPLATE_COMMUNITY_REACT_NATIVE_VERSION)) {\n      logger.warn(\n        `Use ${chalk.bold('--template')} and ${chalk.bold(\n          '--version',\n        )} only if you know what you're doing. Here be dragons üêâ.`,\n      );\n    } else {\n      throw new TemplateAndVersionError(options.template);\n    }\n  }\n\n  const root = process.cwd();\n\n  const directoryName = path.relative(root, options.directory || projectName);\n  const projectFolder = path.join(root, directoryName);\n\n  if (options.pm && !checkPackageManagerAvailability(options.pm)) {\n    logger.error(\n      'Seems like the package manager you want to use is not installed. Please install it or choose another package manager.',\n    );\n    return;\n  }\n\n  let shouldBumpYarnVersion = true;\n  let shouldCreateGitRepository = false;\n\n  const isGitAvailable = await checkGitInstallation();\n\n  if (isGitAvailable) {\n    const isFolderGitRepo = await checkIfFolderIsGitRepo(projectFolder);\n\n    if (isFolderGitRepo) {\n      shouldBumpYarnVersion = false;\n    } else {\n      shouldCreateGitRepository = true; // Initialize git repo after creating project\n    }\n  } else {\n    logger.warn(\n      'Git is not installed on your system. This might cause some features to work incorrectly.',\n    );\n  }\n\n  const {didInstallPods} = await createProject(\n    projectName,\n    directoryName,\n    version,\n    shouldBumpYarnVersion,\n    options,\n  );\n\n  if (shouldCreateGitRepository && !options.skipGitInit) {\n    await createGitRepository(projectFolder);\n  }\n\n  printRunInstructions(projectFolder, projectName, {\n    showPodsInstructions: !didInstallPods,\n  });\n});\n"],"mappings":"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"}