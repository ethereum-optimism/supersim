{"version":3,"names":["handleLaunchResult","success","errorMessage","errorDetails","logger","error","installApp","buildOutput","xcodeProject","mode","scheme","target","udid","binaryPath","platform","appPath","buildSettings","getBuildSettings","CLIError","getBuildPath","targetBuildDir","TARGET_BUILD_DIR","infoPlistPath","INFOPLIST_PATH","info","chalk","bold","child_process","spawnSync","stdio","bundleID","execFileSync","path","join","encoding","trim","result","status","stderr","toString"],"sources":["../../../src/commands/runCommand/installApp.ts"],"sourcesContent":["import child_process from 'child_process';\nimport {CLIError, logger} from '@react-native-community/cli-tools';\nimport {IOSProjectInfo} from '@react-native-community/cli-types';\nimport chalk from 'chalk';\nimport {getBuildPath} from './getBuildPath';\nimport {getBuildSettings} from './getBuildSettings';\nimport path from 'path';\nimport {ApplePlatform} from '../../types';\n\nfunction handleLaunchResult(\n  success: boolean,\n  errorMessage: string,\n  errorDetails = '',\n) {\n  if (success) {\n    logger.success('Successfully launched the app');\n  } else {\n    logger.error(errorMessage, errorDetails);\n  }\n}\n\ntype Options = {\n  buildOutput: string;\n  xcodeProject: IOSProjectInfo;\n  mode: string;\n  scheme: string;\n  target?: string;\n  udid: string;\n  binaryPath?: string;\n  platform?: ApplePlatform;\n};\n\nexport default async function installApp({\n  buildOutput,\n  xcodeProject,\n  mode,\n  scheme,\n  target,\n  udid,\n  binaryPath,\n  platform,\n}: Options) {\n  let appPath = binaryPath;\n\n  const buildSettings = await getBuildSettings(\n    xcodeProject,\n    mode,\n    buildOutput,\n    scheme,\n    target,\n  );\n\n  if (!buildSettings) {\n    throw new CLIError('Failed to get build settings for your project');\n  }\n\n  if (!appPath) {\n    appPath = await getBuildPath(buildSettings, platform);\n  }\n\n  const targetBuildDir = buildSettings.TARGET_BUILD_DIR;\n  const infoPlistPath = buildSettings.INFOPLIST_PATH;\n\n  if (!infoPlistPath) {\n    throw new CLIError('Failed to find Info.plist');\n  }\n\n  if (!targetBuildDir) {\n    throw new CLIError('Failed to get target build directory.');\n  }\n\n  logger.info(`Installing \"${chalk.bold(appPath)}`);\n\n  if (udid && appPath) {\n    child_process.spawnSync('xcrun', ['simctl', 'install', udid, appPath], {\n      stdio: 'inherit',\n    });\n  }\n\n  const bundleID = child_process\n    .execFileSync(\n      '/usr/libexec/PlistBuddy',\n      [\n        '-c',\n        'Print:CFBundleIdentifier',\n        path.join(targetBuildDir, infoPlistPath),\n      ],\n      {encoding: 'utf8'},\n    )\n    .trim();\n\n  logger.info(`Launching \"${chalk.bold(bundleID)}\"`);\n\n  let result = child_process.spawnSync('xcrun', [\n    'simctl',\n    'launch',\n    udid,\n    bundleID,\n  ]);\n\n  handleLaunchResult(\n    result.status === 0,\n    'Failed to launch the app on simulator',\n    result.stderr.toString(),\n  );\n}\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;AACA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAwB;AAGxB,SAASA,kBAAkB,CACzBC,OAAgB,EAChBC,YAAoB,EACpBC,YAAY,GAAG,EAAE,EACjB;EACA,IAAIF,OAAO,EAAE;IACXG,kBAAM,CAACH,OAAO,CAAC,+BAA+B,CAAC;EACjD,CAAC,MAAM;IACLG,kBAAM,CAACC,KAAK,CAACH,YAAY,EAAEC,YAAY,CAAC;EAC1C;AACF;AAae,eAAeG,UAAU,CAAC;EACvCC,WAAW;EACXC,YAAY;EACZC,IAAI;EACJC,MAAM;EACNC,MAAM;EACNC,IAAI;EACJC,UAAU;EACVC;AACO,CAAC,EAAE;EACV,IAAIC,OAAO,GAAGF,UAAU;EAExB,MAAMG,aAAa,GAAG,MAAM,IAAAC,kCAAgB,EAC1CT,YAAY,EACZC,IAAI,EACJF,WAAW,EACXG,MAAM,EACNC,MAAM,CACP;EAED,IAAI,CAACK,aAAa,EAAE;IAClB,MAAM,KAAIE,oBAAQ,EAAC,+CAA+C,CAAC;EACrE;EAEA,IAAI,CAACH,OAAO,EAAE;IACZA,OAAO,GAAG,MAAM,IAAAI,0BAAY,EAACH,aAAa,EAAEF,QAAQ,CAAC;EACvD;EAEA,MAAMM,cAAc,GAAGJ,aAAa,CAACK,gBAAgB;EACrD,MAAMC,aAAa,GAAGN,aAAa,CAACO,cAAc;EAElD,IAAI,CAACD,aAAa,EAAE;IAClB,MAAM,KAAIJ,oBAAQ,EAAC,2BAA2B,CAAC;EACjD;EAEA,IAAI,CAACE,cAAc,EAAE;IACnB,MAAM,KAAIF,oBAAQ,EAAC,uCAAuC,CAAC;EAC7D;EAEAd,kBAAM,CAACoB,IAAI,CAAE,eAAcC,gBAAK,CAACC,IAAI,CAACX,OAAO,CAAE,EAAC,CAAC;EAEjD,IAAIH,IAAI,IAAIG,OAAO,EAAE;IACnBY,wBAAa,CAACC,SAAS,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAEhB,IAAI,EAAEG,OAAO,CAAC,EAAE;MACrEc,KAAK,EAAE;IACT,CAAC,CAAC;EACJ;EAEA,MAAMC,QAAQ,GAAGH,wBAAa,CAC3BI,YAAY,CACX,yBAAyB,EACzB,CACE,IAAI,EACJ,0BAA0B,EAC1BC,eAAI,CAACC,IAAI,CAACb,cAAc,EAAEE,aAAa,CAAC,CACzC,EACD;IAACY,QAAQ,EAAE;EAAM,CAAC,CACnB,CACAC,IAAI,EAAE;EAET/B,kBAAM,CAACoB,IAAI,CAAE,cAAaC,gBAAK,CAACC,IAAI,CAACI,QAAQ,CAAE,GAAE,CAAC;EAElD,IAAIM,MAAM,GAAGT,wBAAa,CAACC,SAAS,CAAC,OAAO,EAAE,CAC5C,QAAQ,EACR,QAAQ,EACRhB,IAAI,EACJkB,QAAQ,CACT,CAAC;EAEF9B,kBAAkB,CAChBoC,MAAM,CAACC,MAAM,KAAK,CAAC,EACnB,uCAAuC,EACvCD,MAAM,CAACE,MAAM,CAACC,QAAQ,EAAE,CACzB;AACH"}